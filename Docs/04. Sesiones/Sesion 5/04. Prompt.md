PROMPT SESI√ìN 5 ‚Äî Conexi√≥n al HUB + Social

Estoy construyendo una aplicaci√≥n web de mascotas virtuales llamada Regenmon usando Next.js y NES.css (estilo pixel art con la fuente "Press Start 2P"). Ya tengo las sesiones 1 a 4 funcionando: mi Regenmon se crea, conversa, come, entrena y evoluciona. Todos los datos de mi Regenmon est√°n en localStorage.

Ahora necesito la Sesi√≥n 5: conectar mi aplicaci√≥n al HUB central para que mi Regenmon aparezca en el ranking global y pueda interactuar con los Regenmons de otros estudiantes.

EL HUB YA EXISTE en https://regenmon-final.vercel.app y tiene APIs p√∫blicas. NO necesito base de datos propia ‚Äî solo llamo a las APIs del HUB.

---

‚ö†Ô∏è REGLA CR√çTICA ‚Äî PERSISTENCIA EN LOCALSTORAGE:

Esta es la regla m√°s importante de toda la sesi√≥n 5. Cuando el usuario se registra en el HUB, la API devuelve un objeto con un campo "id". Ese ID es la identidad del Regenmon en el HUB y DEBE guardarse en localStorage inmediatamente:

localStorage.setItem("hubRegenmonId", data.data.id)

Adem√°s guardar un flag:
localStorage.setItem("isRegisteredInHub", "true")

AL CARGAR CUALQUIER P√ÅGINA de la sesi√≥n 5, lo PRIMERO que debe hacer es:
const hubId = localStorage.getItem("hubRegenmonId")
const isRegistered = localStorage.getItem("isRegisteredInHub") === "true"

Si isRegistered es true y hubId existe:
- NO mostrar el formulario de registro
- Ir DIRECTO a la vista de √©xito / panel social
- Usar hubId para todas las llamadas al API

Si isRegistered es false o hubId no existe:
- Mostrar formulario de registro

NUNCA pedir registrarse de nuevo si ya tiene hubId en localStorage. NUNCA.

---

PARTE 1: REGISTRO EN EL HUB

Crear un componente RegisterHub que se muestre en la pesta√±a "Social". El flujo es:

PASO 1 ‚Äî Verificar si ya est√° registrado:
- Leer localStorage: hubRegenmonId e isRegisteredInHub
- Si ya est√° registrado ‚Üí saltar directo a PASO 4 (vista social)
- Si NO est√° registrado ‚Üí mostrar formulario

PASO 2 ‚Äî Formulario de registro:
- Los datos se detectan AUTOM√ÅTICAMENTE, el usuario NO los llena:
  - name: leer del localStorage donde guardas el nombre del Regenmon
  - ownerName: leer del localStorage donde guardas el nombre del due√±o
  - appUrl: usar window.location.origin (la URL de donde est√© desplegada la app, puede ser .pages.dev, .vercel.app, .netlify.app, localhost, o cualquier dominio)
  - sprite: convertir el emoji del Regenmon a URL de imagen. Usar esta funci√≥n:

function getSpriteUrl(emoji) {
  const codePoints = [...emoji].map(c => c.codePointAt(0).toString(16)).join('-');
  return `https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/72x72/${codePoints}.png`;
}

- El √öNICO campo que el usuario puede llenar opcionalmente es su email
- Mostrar un preview del Regenmon con su nombre, sprite y stats antes de registrar

PASO 3 ‚Äî Llamar al API:
POST https://regenmon-final.vercel.app/api/register
Headers: { "Content-Type": "application/json" }
Body: { name, ownerName, ownerEmail (opcional), appUrl, sprite }

La respuesta ser√°:
{ success: true, data: { id: "xxx", name: "...", appUrl: "...", balance: 0, ... } }

IMPORTANTE: Si la API responde con alreadyRegistered: true, significa que este appUrl ya fue registrado antes. Tomar el id de la respuesta y guardarlo.

Inmediatamente despu√©s de recibir respuesta exitosa:
1. localStorage.setItem("hubRegenmonId", response.data.id)
2. localStorage.setItem("isRegisteredInHub", "true")
3. Cambiar vista al panel social (NO recargar p√°gina, solo cambiar estado)

PASO 4 ‚Äî Vista post-registro (panel social):
Esta vista se muestra siempre que isRegisteredInHub sea true. Incluye:
- Badge "HUB MEMBER" con el nombre del Regenmon
- Bot√≥n "üèÜ Leaderboard" ‚Üí navega a /leaderboard
- Bot√≥n "üë§ Mi Perfil" ‚Üí navega a /regenmon/{hubRegenmonId}
- Secci√≥n de actividad reciente (ver PARTE 6)

---

PARTE 2: SINCRONIZACI√ìN AUTOM√ÅTICA

Crear un hook useHubSync que sincronice datos con el HUB:

POST https://regenmon-final.vercel.app/api/sync
Headers: { "Content-Type": "application/json" }
Body: {
  regenmonId: localStorage.getItem("hubRegenmonId"),
  stats: { happiness, energy, hunger },
  totalPoints: (leer de localStorage),
  trainingHistory: [] (array vac√≠o est√° bien si no hay historial)
}

La sincronizaci√≥n debe ejecutarse:
- Al registrarse por primera vez
- Despu√©s de cada entrenamiento completado
- Cada 5 minutos con setInterval (solo si est√° registrado)

El HUB responde con:
{ data: { balance: 150, tokensEarned: 25, totalPoints: 300 } }

Guardar el balance actualizado en localStorage si cambi√≥.

---

PARTE 3: LEADERBOARD

Crear p√°gina /leaderboard que consuma:
GET https://regenmon-final.vercel.app/api/leaderboard?page=1&limit=10

Respuesta: { data: [{ rank, id, name, ownerName, sprite, stage, totalPoints, balance }], pagination: { page, totalPages, total } }

Mostrar:
- ü•áü•àü•â para top 3, luego #4, #5...
- Imagen sprite (usar tag <img> con la URL del sprite)
- Nombre, due√±o, stage, puntos y $FRUTA
- Bot√≥n "Ver" en cada fila ‚Üí navega a /regenmon/{id}
- Paginaci√≥n: botones "‚Üê Anterior" y "Siguiente ‚Üí"
- Bot√≥n "‚Üê Volver" para regresar a la app principal

---

PARTE 4: PERFIL P√öBLICO DE OTROS REGENMONS

Crear p√°gina /regenmon/[id] que consuma:
GET https://regenmon-final.vercel.app/api/regenmon/{id}

Respuesta: { data: { id, name, ownerName, sprite, stage, stats, totalPoints, balance, totalVisits, registeredAt } }

Mostrar:
- Sprite grande
- Nombre y due√±o
- Stage con indicador visual
- Stats (felicidad, energ√≠a, hambre) con barras de progreso coloridas
- Puntos y balance de $FRUTA
- Total de visitas
- Fecha de registro formateada

IMPORTANTE: Detectar si este perfil es M√çO o de OTRO:
const myHubId = localStorage.getItem("hubRegenmonId")
const isMyProfile = myHubId === id (el id de la URL)

- Si es MI perfil: mostrar solo info, sin botones de interacci√≥n
- Si es de OTRO: mostrar los botones de interacci√≥n social (PARTE 5)
- Si NO estoy registrado en el HUB: mostrar mensaje "Reg√≠strate en el HUB para interactuar" con link a la pesta√±a Social

---

PARTE 5: INTERACCIONES SOCIALES

Estos botones SOLO aparecen en perfiles de OTROS Regenmons y SOLO si yo tengo hubRegenmonId en localStorage.

A) ALIMENTAR:
Bot√≥n "üçé Dar de comer (-10 $FRUTA)"
- Deshabilitado si mi balance < 10 (mostrar "Sin $FRUTA suficiente")
- Al hacer clic:
  POST https://regenmon-final.vercel.app/api/regenmon/{id}/feed
  Body: { fromRegenmonId: localStorage.getItem("hubRegenmonId") }
- Respuesta exitosa: { data: { senderBalance: 140, targetName: "Rex", cost: 10 } }
- Actualizar mi balance en localStorage
- Mostrar toast/notificaci√≥n: "¬°Le diste de comer a Rex! -10 $FRUTA"
- Animaci√≥n de üçé volando hacia el sprite del otro Regenmon

B) ENVIAR REGALO:
Botones "üéÅ 5", "üéÅ 10", "üéÅ 25" (tres opciones de cantidad)
- Cada bot√≥n deshabilitado si mi balance < esa cantidad
- Al hacer clic:
  POST https://regenmon-final.vercel.app/api/regenmon/{id}/gift
  Body: { fromRegenmonId: localStorage.getItem("hubRegenmonId"), amount: 10 }
- Respuesta: { data: { senderBalance: 130, targetName: "Rex", amount: 10 } }
- Actualizar mi balance en localStorage
- Mostrar: "¬°Enviaste 10 $FRUTA a Rex! üéÅ"

C) MENSAJES:
Secci√≥n debajo del perfil con lista de mensajes y formulario para enviar:

Leer mensajes:
GET https://regenmon-final.vercel.app/api/regenmon/{id}/messages?limit=20
Respuesta: { data: { messages: [{ id, fromName, message, createdAt }] } }

Enviar mensaje:
POST https://regenmon-final.vercel.app/api/regenmon/{id}/messages
Body: {
  fromRegenmonId: localStorage.getItem("hubRegenmonId"),
  fromName: (leer nombre del due√±o de localStorage),
  message: "texto del mensaje"
}

- M√°ximo 140 caracteres con contador visible
- Mostrar mensajes en orden cronol√≥gico (m√°s recientes arriba)
- Cada mensaje muestra: nombre del remitente, texto, y tiempo relativo ("hace 5 min", "hace 1 hora")
- Despu√©s de enviar, agregar el mensaje a la lista sin recargar

---

PARTE 6: ACTIVIDAD RECIENTE

En la vista post-registro (pesta√±a Social), mostrar actividad reciente:

GET https://regenmon-final.vercel.app/api/regenmon/{hubRegenmonId}/activity?limit=10

Respuesta: { data: { activity: [{ type, description, amount, createdAt }] } }

Tipos posibles:
- "feed_received" ‚Üí "üçé Rex te dio de comer"
- "gift_received" ‚Üí "üéÅ Rex te envi√≥ 10 $FRUTA"
- "message_received" ‚Üí "üì® Rex: tu mensaje aqu√≠"

Si no hay actividad, mostrar: "A√∫n no hay actividad. ¬°Comparte tu perfil!"

---

ESTILO VISUAL:

Todo con NES.css pixel art:
- Clases: nes-container, nes-btn, nes-badge, nes-input, nes-textarea, nes-progress
- Fuente "Press Start 2P"
- Colores: naranja (#f97316) acentos, amarillo stats, verde √©xito, rojo errores
- Fondo oscuro, bordes pixelados
- Responsive: en mobile (max-width: 768px) usar flex-direction: column, fuentes m√°s peque√±as, botones de ancho completo

MANEJO DE ERRORES:
- Si fetch falla o el HUB no responde: mostrar "El HUB est√° descansando, intenta despu√©s üçé" (NO mostrar errores t√©cnicos al usuario)
- Si balance insuficiente: deshabilitar bot√≥n, mostrar balance actual
- Si hay error de red: reintentar 1 vez autom√°ticamente despu√©s de 2 segundos
- Siempre usar try/catch en todas las llamadas fetch

ESTRUCTURA DE ARCHIVOS sugerida:
- /app/leaderboard/page.tsx ‚Üí Leaderboard global
- /app/regenmon/[id]/page.tsx ‚Üí Perfil p√∫blico con interacciones
- /app/components/RegisterHub.tsx ‚Üí Registro + vista post-registro
- /app/components/SocialActions.tsx ‚Üí Feed, gift, mensajes
- /app/components/ActivityFeed.tsx ‚Üí Panel de actividad
- /app/hooks/useHub.ts ‚Üí Hook con todas las llamadas al API del HUB
- /app/hooks/useHubSync.ts ‚Üí Hook de sincronizaci√≥n autom√°tica
